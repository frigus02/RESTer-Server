<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="rester-icons.html">

<dom-module id="rester-app">
    <template>
        <style>
            :host {
                --primary-text-color: var(--light-theme-text-color);
                --primary-background-color: var(--light-theme-background-color);
                --secondary-text-color: var(--light-theme-secondary-color);
                --disabled-text-color: var(--light-theme-disabled-color);
                --divider-color: var(--light-theme-divider-color);
                --error-color: var(--paper-deep-orange-a700);

                --primary-color: var(--paper-cyan-500);
                --light-primary-color: var(--paper-cyan-100);
                --dark-primary-color: var(--paper-cyan-700);

                --accent-color: var(--paper-amber-a200);
                --light-accent-color: var(--paper-amber-a100);
                --dark-accent-color: var(--paper-amber-a400);

                display: block;
                min-height: 100vh;
                background-color: var(--primary-background-color);
                color: var(--primary-text-color);
                @apply(--paper-font-common-base);
            }

            app-header {
                background-color: var(--primary-color);
            }

            app-header .logo {
                width: 32px;
                margin-right: 16px;
            }

            app-header [role="navigation"] a {
                text-transform: uppercase;
                text-decoration: none;
                padding: 0 12px;
                line-height: 48px;
                color: inherit;
            }

            footer {
                font-size: 0.8em;
                text-align: center;
                padding: 16px;
            }
        </style>

        <app-location route="{{route}}"></app-location>
        <app-route route="{{route}}"
                pattern="/:page"
                data="{{routeData}}"
                tail="{{subroute}}"></app-route>

        <app-header-layout>
            <app-header slot="header" effects="waterfall" fixed shadow>
                <app-toolbar>
                    <img src="/images/icon.svg" class="logo">
                    <div main-title>RESTer <small>A REST client for almost any web service.</small></div>
                </app-toolbar>
                <paper-tabs role="navigation" selected="0" scrollable>
                    <paper-tab link><a href="/">Home</a></paper-tab>
                    <paper-tab link><a href="/sts/issue/oauth2/authorize?response_type=token&client_id=rester&redirect_uri=http%3A//localhost%3A3000/test">Login</a></paper-tab>
                    <paper-tab link><a href="/account">Account</a></paper-tab>
                    <paper-tab link><a href="/view2">View2</a></paper-tab>
                </paper-tabs>
            </app-header>
            <div>
                <iron-pages selected="[[page]]"
                        attr-for-selected="name"
                        fallback-selection="error"
                        role="main">
                    <rester-page-home name="home"></rester-page-home>
                    <rester-page-view2 name="view2"></rester-page-view2>
                    <rester-page-view3 name="view3"></rester-page-view3>
                    <rester-page-error name="error" error="[[error]]"></rester-page-error>
                </iron-pages>

                <footer>
                    <a href="https://github.com/frigus02/RESTer">RESTer on GitHub</a> -
                    <a href="https://github.com/frigus02/RESTer-Server">This website on GitHub</a> -
                    <a href="/imprint">Imprint</a>
                </footer>
            </div>
        </app-header-layout>
    </template>

    <script>
        class ResterApp extends Polymer.Element {
            static get is() {
                return 'rester-app';
            }

            static get properties() {
                return {
                    page: {
                        type: String,
                        observer: '_pageChanged'
                    },
                    error: Object
                };
            }

            static get observers() {
                return [
                    '_routePageChanged(routeData.page)'
                ];
            }

            constructor() {
                super();

                if (state && state.error) {
                    this.error = state.error;
                    this.page = 'error';
                    this._skipNextRouteChange = true;
                }
            }

            _routePageChanged(page) {
                if (page === undefined) {
                    return;
                }

                if (this._skipNextRouteChange) {
                    this._skipNextRouteChange = false;
                    return;
                }

                this.page = page || 'home';
            }

            _pageChanged(page) {
                const resolvedPageUrl = this.resolveUrl('rester-page-' + page + '.html');
                Polymer.importHref(
                    resolvedPageUrl,
                    null,
                    this._showPage404.bind(this),
                    true);
            }

            _showPage404() {
                this.error = {
                    code: 404,
                    message: 'Not Found'
                };
                this.page = 'error';
            }
        }

        window.customElements.define(ResterApp.is, ResterApp);
    </script>
</dom-module>
