#!/usr/bin/env node

/* eslint-disable no-console */

'use strict';

require('dotenv').config();

const http = require('http');

const appFactory = require('../app/app');

appFactory()
    .then(app => {
        const port = process.env.PORT || 3000;
        app.set('port', port);

        const server = http.createServer(app);
        server.listen(port);
        server.on('error', error => {
            console.log(`Error ${error.code}.`, error);
            throw error;
        });
        server.on('listening', () => {
            const addr = server.address();
            console.log(`Listening on http://localhost:${addr.port}/`);
        });
    })
    .catch(err => {
        console.error('Failed to setup app.');
        console.error(err);
        process.exit(1);
    });
